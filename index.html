<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Sphynx Overdrive: Maximum Reality</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<link rel="manifest" href="manifest.json">
<style>
body { margin:0; background:#000; display:flex; justify-content:center; align-items:center; height:100vh; overflow:hidden; }
#game-container { position:relative; width:400px; height:600px; background:#050505; border:4px solid #ff00ff; box-shadow:0 0 20px #ff00ff; font-family:'Courier New', monospace; overflow:hidden; }
canvas { position:absolute; top:0; left:0; }
#ui { position:absolute; width:100%; display:flex; justify-content:space-between; padding:10px; color:#00ffff; text-shadow:0 0 5px #00ffff; z-index:10; box-sizing:border-box; }
#game-over { display:none; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); text-align:center; color:#ff00ff; z-index:20; background:rgba(0,0,0,0.9); padding:20px; border:2px solid #00ffff; }
button { background:#00ffff; border:none; padding:10px 20px; cursor:pointer; font-weight:bold; }
.crt-overlay { position:absolute; top:0; left:0; width:100%; height:100%; background:linear-gradient(rgba(18,16,16,0) 50%, rgba(0,0,0,0.1) 50%), linear-gradient(90deg, rgba(255,0,0,0.03), rgba(0,255,0,0.01), rgba(0,0,255,0.03)); background-size:100% 3px,3px 100%; pointer-events:none; z-index:5; }
</style>
</head>
<body>
<div id="game-container">
    <canvas id="bgCanvas"></canvas>
    <canvas id="gameCanvas"></canvas>
    <canvas id="particleCanvas"></canvas>

    <div id="ui">
        <div id="score">DATA: 0kb</div>
        <div id="lives">NODES: 3</div>
    </div>
    <div class="crt-overlay"></div>

    <div id="game-over">
        <h1>SYSTEM CRASHED</h1>
        <button onclick="resetGame()">REBOOT</button>
    </div>
</div>

<script>
// --- Load Images ---
const azulImg = new Image();
azulImg.src = 'flyazulo.png'; // Azul floating news desk cat

const mochkilNormal = new Image();
mochkilNormal.src = 'mochkil_front_kart.png'; // Mochkil normal

const mochkilSnack = new Image();
mochkilSnack.src = 'mochkil_walk_right_cake.png'; // Mochkil carrying snack

// --- Mochkil ---
const mochkil = { x: -50, y: 450, w: 40, h: 40, speed: 2, dir: 1, carryingSnack: true };

// --- Draw Mochkil ---
function drawMochkil() {
    const img = mochkil.carryingSnack ? mochkilSnack : mochkilNormal;
    ctx.drawImage(img, mochkil.x, mochkil.y, mochkil.w, mochkil.h);
}

// --- Draw Azul ---
function drawAzul() {
    ctx.drawImage(azulImg, 50, 50, 80, 40);
}

// --- Update Function ---
function update() {
    if (!gameActive) return;

    // --- Background City ---
    bctx.fillStyle = '#050005';
    bctx.fillRect(0, 0, W, H);
    buildings.forEach(b => { b.update(2 + score / 100); b.draw(); });

    // --- Clear Game Layer ---
    ctx.setTransform(1, 0, 0, 1, 0, 0);
    ctx.clearRect(0, 0, W, H);
    applyScreenShake();

    // --- Draw Azul and Mochkil ---
    drawAzul();
    drawMochkil();
    mochkil.x += mochkil.speed * mochkil.dir;
    if (mochkil.x > W + 50 || mochkil.x < -100) mochkil.dir *= -1;

    // --- Player Cat ---
    ctx.font = '40px serif';
    ctx.shadowBlur = 15; ctx.shadowColor = '#00ffff';
    ctx.fillText('ðŸˆâ€â¬›', cat.x, cat.y + 35);
    ctx.shadowBlur = 0;

    // --- Obstacles ---
    if (frame % 60 === 0) {
        const type = Math.random() > 0.3 ? 'firewall' : 'data';
        obstacles.push({ x: Math.random() * (W - 40), y: -50, type, speed: 3 + score / 100 });
    }

    obstacles.forEach((o, i) => {
        o.y += o.speed;
        ctx.fillStyle = o.type === 'firewall' ? '#ff0055' : '#00ff00';
        ctx.fillRect(o.x, o.y, o.type === 'firewall' ? 60 : 20, 10);

        // --- Cat collision ---
        if (cat.x < o.x + (o.type === 'firewall' ? 60 : 20) &&
            cat.x + 40 > o.x &&
            cat.y < o.y + 10 &&
            cat.y + 40 > o.y) {
            if (o.type === 'firewall') {
                lives--; screenShake = 20;
                if (lives <= 0) { gameActive = false; document.getElementById('game-over').style.display = 'block'; }
            } else {
                score += 10; screenShake = 5;
            }
            obstacles.splice(i, 1);
            document.getElementById('score').innerText = `DATA: ${score}kb`;
            document.getElementById('lives').innerText = `NODES: ${lives}`;
        }

        if (o.y > H) obstacles.splice(i, 1);
    });

    // --- Mochkil Interactions (snatching data) ---
    obstacles.forEach((o, i) => {
        if (
            mochkil.x < o.x + (o.type === 'firewall' ? 60 : 20) &&
            mochkil.x + mochkil.w > o.x &&
            mochkil.y < o.y + 10 &&
            mochkil.y + mochkil.h > o.y
        ) {
            if (o.type === 'data') {
                score += 15; // Mochkil bonus points
                mochkil.carryingSnack = true; // optional: show snack
                obstacles.splice(i, 1);
            } else if (o.type === 'firewall') {
                mochkil.dir *= -1; // bounce back
            }
            document.getElementById('score').innerText = `DATA: ${score}kb`;
        }
    });

    // --- Butterflies ---
    pctx.clearRect(0, 0, W, H);
    butterflies.forEach(b => { b.update(); b.draw(); });

    frame++;
    requestAnimationFrame(update);
}
</script>
</body>
</html>
